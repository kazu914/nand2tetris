# 第五章
## メモリ

|address|14|13|12|11|10|9|8|7|6|5|4|3|2|1|0|
|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|
|16383|0|1|1|1|1|1|1|1|1|1|1|1|1|1|1|
|16384|1|0|0|0|0|0|0|0|0|0|0|0|0|0|0|
|24576|1|1|0|0|0|0|0|0|0|0|0|0|0|0|0|

address[13],address[14]でどこに割り振るかが決まる．  
screenとRAM16Kのloadは，`(そのデバイスに割り振るか) And (load)` を入れれば良い.  
最終的な出力はマルチプレクサ2つ使えばうまく選択できる.  

```
if address < 2 ** 14: // address[14] == 0
	そのままRAM16Kに入れる
else if adress < 24576: // address[13] == 0
	スクリーンに入れる
else if address == 24576: // address [13] == 1 (無効なアドレスが入力されなければこの条件で十分)
	キーボードに入れる
else:
	無効
```

## CPU 
### 整理

- Dレジスタ: データ値のみを保持
- Aレシスタ: データ値またはメモリアドレス
- M: Aレジスタの値をアドレスとするメモリの値
- A命令: Aレジスタに15ビットの値を設定する命令
- C命令: 計算を行う.
  - `comp`: 計算の命令
  - `dest`: 計算結果の保存場所
  - `jump`: ジャンプする条件

|命令|15|14|13|12|11|10|9 |8 |7 |6 |5 |4 |3 |2 |1 |0 |
|-|--|--|--|--|--|--|--|--|--|--|--|--|--|--|--|--|
|A命令|0 |v |v |v |v |v |v |v |v |v |v |v |v |v |v |v |
|C命令|1 |1 |1 |a |c1|c2|c3|c4|c5|c6|d1|d2|d3|j1|j2|j3|


|a=0 |c1|c2|c3|c4|c5|c6|a=1 |
|----|--|--|--|--|--|--|----|
|0   |1 |0 |1 |0 |1 |0 |    |
|1   |1 |1 |1 |1 |1 |1 |    |
|-1  |1 |1 |1 |0 |1 |0 |    |
|D   |0 |0 |1 |1 |0 |0 |    |
|A   |1 |1 |0 |0 |0 |0 |M   |
|!D  |0 |0 |1 |1 |0 |1 |    |
|!A  |1 |1 |0 |0 |0 |1 |!M  |
|-D  |0 |0 |1 |1 |1 |1 |    |
|-A  |1 |1 |0 |0 |1 |1 |-M  |
|D+1 |0 |1 |1 |1 |1 |1 |    |
|A+1 |1 |1 |0 |1 |1 |1 |M+1 |
|D-1 |0 |0 |1 |1 |1 |0 |    |
|A-1 |1 |1 |0 |0 |1 |0 |M-1 |
|D+A |0 |0 |0 |0 |1 |0 |D+M |
|D-A |0 |1 |0 |0 |1 |1 |D-M |
|A-D |0 |0 |0 |1 |1 |1 |M-D |
|D&A |0 |0 |0 |0 |0 |0 |D&M |
|D\|A|0 |1 |0 |1 |0 |1 |D\|M|

| d1   | d2   | d3   | 保存先 |
| ---- | ---- | ---- | ------ |
| 0    | 0    | 0    | nill   |
| 0    | 0    | 1    | M      |
| 0    | 1    | 0    | D      |
| 0    | 1    | 1    | MD     |
| 1    | 0    | 0    | A      |
| 1    | 0    | 1    | AM     |
| 1    | 1    | 0    | AD     |
| 1    | 1    | 1    | AMD    |

|j1|j2|j3|効果   |
|-|--|--|--------|
|0|0 |0 |no jump |
|0|0 |1 |out > 0 |
|0|1 |0 |out = 0 |
|0|1 |1 |out >= 0|
|1|0 |0 |out < 0 |
|1|0 |1 |out != 0|
|1|1 |0 |out <= 0|
|1|1 |1 |jump    |

|回路図|
|-|
|![picture](./fig/cpu.png)|
